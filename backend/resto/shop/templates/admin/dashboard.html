{% extends "admin/base_site.html" %}

{% block title %}Dashboard – Administration{% endblock %}

{% block content %}
<h1>Dashboard Resto</h1>

<p>Aujourd'hui : {{ today }}</p>

<div style="display:flex; gap:20px; flex-wrap:wrap;">

  <div style="border:1px solid #ccc; padding:15px; min-width:180px;">
    <h3>Commandes du jour</h3>
    <p style="font-size:24px; font-weight:bold;">{{ orders_count_today }}</p>
  </div>

  <div style="border:1px solid #ccc; padding:15px; min-width:180px;">
    <h3>Ventes du jour</h3>
    <p style="font-size:24px; font-weight:bold;">{{ total_sales_today }} FCFA</p>
  </div>

  <div style="border:1px solid #ccc; padding:15px; min-width:180px;">
    <h3>Commandes en attente</h3>
    <p style="font-size:24px; font-weight:bold;">{{ pending_orders_count }}</p>
  </div>

</div>

<h2 style="margin-top:30px;">Top plats</h2>
<table class="admin-dashboard-table">
  <thead>
    <tr>
      <th>Plat</th>
      <th>Quantité vendue</th>
      <th>Chiffre d'affaires (FCFA)</th>
    </tr>
  </thead>
  <tbody>
    {% for m in top_meals %}
      <tr>
        <td>{{ m.meal__name }}</td>
        <td>{{ m.quantity_sold }}</td>
        <td>{{ m.revenue }}</td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="3">Pas encore de ventes suffisantes pour faire un classement.</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
<h2 style="margin-top:40px;">Gestion des plats</h2>

<div style="margin-bottom:10px;">
  <!-- Boutons vers l'admin -->
  <a href="{% url 'admin:shop_meal_add' %}" class="button" style="margin-right:10px;">
    + Ajouter un plat
  </a>
  <a href="{% url 'admin:shop_meal_changelist' %}" class="button">
    Voir la liste complète dans l’admin
  </a>
</div>

<table class="admin-dashboard-table">
  <thead>
    <tr>
      <th>ID</th>
      <th>Nom</th>
      <th>Catégorie</th>
      <th>Prix</th>
      <th>Actif</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for meal in meals %}
      <tr>
        <td>{{ meal.id }}</td>
        <td>{{ meal.name }}</td>
        <td>{{ meal.category.name }}</td>
        <td>{{ meal.price }} FCFA</td>
        <td>{{ meal.is_active|yesno:"Oui,Non" }}</td>
        <td>
          <!-- Modifier dans l’admin -->
          <a href="{% url 'admin:shop_meal_change' meal.id %}">Modifier</a>
          |
          <!-- Supprimer dans l’admin (page de confirmation) -->
          <a href="{% url 'admin:shop_meal_delete' meal.id %}">Supprimer</a>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="6">Aucun plat enregistré.</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<thead>
  <tr>
    <th>ID</th>
    <th>Client</th>
    <th>User</th>
    <th>Total</th>
    <th>Statut</th>
    <th>Action</th>
  </tr>
</thead>
<tbody>
  {% for order in orders_today %}
    <tr>
      <td>{{ order.id }}</td>
      <td>{{ order.customer_name }}</td>
      <td>
        {% if order.user %}
          {{ order.user.username }}
        {% else %}
          -
        {% endif %}
      </td>
      <td>{{ order.total }}</td>
      <td>{{ order.get_status_display }}</td>
      <td>
        {% if order.status != 'delivered' %}
            <form method="post" action="{% url 'mark_order_delivered' order.id %}">
            {% csrf_token %}
            <button type="submit">Marquer livré</button>
            </form>
        {% else %}
            Livrée
        {% endif %}
    </td>
    </tr>
  {% empty %}
    <tr><td colspan="6">Aucune commande aujourd'hui.</td></tr>
  {% endfor %}
</tbody>



{% endblock %}
