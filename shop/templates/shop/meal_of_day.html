{# templates/shop/meal_of_the_day_instagram.html #}
{% extends "base.html" %}
{% block title %}Plat du jour ‚Äì Resto Cuistot{% endblock %}

{% block content %}
<section class="container py-4">

  {% if not meal %}
    <div class="alert alert-warning">Aucun plat du jour n‚Äôest disponible.</div>
  {% else %}

  {# Style ‚ÄúInstagram‚Äù : carte centr√©e, image carr√©e/portrait, actions, commentaires fake #}
  <div class="ig-wrap mx-auto">
    <article class="ig-card shadow-sm">

      <!-- Header -->
      <header class="ig-header">
        <div class="ig-avatar" aria-hidden="true"></div>
        <div class="ig-head-txt">
          <div class="ig-title">Resto Cuistot</div>
          <div class="ig-sub">
            {{ meal.category.name }} ¬∑ Cutoff {{ cutoff_time|time:"H:i" }}
          </div>
        </div>

        {% if sold_out %}
          <span class="badge bg-danger ig-badge">SOLD OUT</span>
        {% else %}
          <span class="badge text-bg-primary ig-badge">{{ meal.price }} FCFA</span>
        {% endif %}
      </header>

      <!-- Media -->
      <div class="ig-media">
        {% if meal.image %}
          <img src="{{ meal.image.url }}" alt="{{ meal.name }}">
        {% else %}
          <img src="https://via.placeholder.com/1200x1200?text=Resto+Cuistot" alt="{{ meal.name }}">
        {% endif %}
      </div>

      <!-- Actions -->
      <div class="ig-actions">
        <div class="ig-actions-left">
          <button type="button" class="ig-iconbtn" aria-label="J‚Äôaime" {% if sold_out %}disabled{% endif %}>‚ô°</button>
          <button type="button" class="ig-iconbtn" aria-label="Commenter">üí¨</button>
          <button type="button" class="ig-iconbtn" aria-label="Partager">‚úà</button>
        </div>
        <button type="button" class="ig-iconbtn" aria-label="Enregistrer">üîñ</button>
      </div>

      <!-- Content -->
      <div class="ig-body">
        <h1 class="ig-meal">{{ meal.name }}</h1>

        {% if meal.description %}
          <p class="ig-desc">{{ meal.description }}</p>
        {% else %}
          <p class="ig-desc text-muted">Plat du jour. Pas besoin de po√©sie.</p>
        {% endif %}

        <div class="ig-meta">
          <span class="ig-like">1 284 j‚Äôaime</span>
          <span class="ig-time">Aujourd‚Äôhui</span>
        </div>

        <!-- Achat -->
        <form method="post" action="{% url 'orders:cart_add' meal.id %}" class="ig-buy">
          {% csrf_token %}

          <div class="ig-qty">
            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="decQty(this)" {% if sold_out %}disabled{% endif %}>‚àí</button>

            <input type="hidden" name="quantity" value="1">
            <span class="fw-semibold">1</span>

            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="incQty(this)" {% if sold_out %}disabled{% endif %}>+</button>
          </div>

          <button type="submit" class="btn btn-dark btn-lg w-100" {% if sold_out %}disabled{% endif %}>
            {% if sold_out %}Indisponible{% else %}Commander maintenant{% endif %}
          </button>
        </form>

        <!-- ‚ÄúCommentaires‚Äù -->
        <div class="ig-comments">
          <div class="ig-c-line"><strong>client_1</strong> √áa a l‚Äôair violent.</div>
          <div class="ig-c-line"><strong>client_2</strong> Je prends 2.</div>
          <div class="ig-c-more text-muted">Voir les 38 commentaires</div>
        </div>

      </div>
    </article>
  </div>

  {% endif %}
</section>

<style>
/* --- Instagram-like card (simple, robuste) --- */
.ig-wrap{max-width:520px}
.ig-card{background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:16px;overflow:hidden}
.ig-header{display:flex;align-items:center;gap:.75rem;padding:.9rem 1rem;border-bottom:1px solid rgba(0,0,0,.06)}
.ig-avatar{width:40px;height:40px;border-radius:50%;
  background:linear-gradient(135deg,#ff7a18,#af002d 41%,#319197);
}
.ig-head-txt{min-width:0;flex:1}
.ig-title{font-weight:700;line-height:1.1}
.ig-sub{font-size:.85rem;color:#6c757d;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.ig-badge{border-radius:999px}

.ig-media{background:#f6f7f8}
.ig-media img{width:100%;display:block;aspect-ratio:1/1;object-fit:cover}

.ig-actions{display:flex;align-items:center;justify-content:space-between;padding:.6rem .9rem}
.ig-actions-left{display:flex;gap:.35rem}
.ig-iconbtn{border:0;background:transparent;font-size:1.25rem;line-height:1;padding:.25rem .35rem;cursor:pointer}
.ig-iconbtn:disabled{opacity:.5;cursor:not-allowed}

.ig-body{padding:.2rem 1rem 1rem}
.ig-meal{font-size:1.05rem;font-weight:800;margin:.35rem 0 .25rem}
.ig-desc{margin:0 0 .75rem}
.ig-meta{display:flex;justify-content:space-between;color:#6c757d;font-size:.85rem;margin-bottom:.75rem}
.ig-like{font-weight:600;color:#111}

.ig-buy{display:grid;gap:.75rem;margin:.25rem 0 1rem}
.ig-qty{display:flex;align-items:center;gap:.6rem}

.ig-comments{font-size:.92rem}
.ig-c-line{margin:.2rem 0}
.ig-c-more{margin-top:.35rem}
</style>

<script>
function incQty(btn){
  const box = btn.parentElement;
  const input = box.querySelector('input[name="quantity"]');
  const span = box.querySelector('span');
  let val = parseInt(input.value || "1", 10);
  if(val < 20){
    val++;
    input.value = val;
    span.textContent = val;
  }
}
function decQty(btn){
  const box = btn.parentElement;
  const input = box.querySelector('input[name="quantity"]');
  const span = box.querySelector('span');
  let val = parseInt(input.value || "1", 10);
  if(val > 1){
    val--;
    input.value = val;
    span.textContent = val;
  }
}
</script>
{% endblock %}